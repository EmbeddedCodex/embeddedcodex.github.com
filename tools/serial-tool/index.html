<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>电网协议串口工具</title>
    <link rel="stylesheet" href="../../assets/css/main.css">
</head>

<body>
    <div class="container">
        <h1>电网协议串口数据工具</h1>

        <!-- 串口配置部分 -->
        <div class="section">
            <div class="section-title">串口配置</div>
            <div class="row">
                <div class="col">
                    <label for="baud-rate">波特率</label>
                    <select id="baud-rate">
                        <option value="1200">1200</option>
                        <option value="2400">2400</option>
                        <option value="4800">4800</option>
                        <option value="9600">9600</option>
                        <option value="19200">19200</option>
                        <option value="38400">38400</option>
                        <option value="57600">57600</option>
                        <option value="115200" selected>115200</option>
                    </select>
                </div>
                <div class="col">
                    <label for="data-bits">数据位</label>
                    <select id="data-bits">
                        <option value="7">7</option>
                        <option value="8" selected>8</option>
                    </select>
                </div>
            </div>
            <div class="row">
                <div class="col">
                    <label for="parity">校验位</label>
                    <select id="parity">
                        <option value="none">无</option>
                        <option value="even" selected>偶校验</option>
                        <option value="odd">奇校验</option>
                    </select>
                </div>
                <div class="col">
                    <label for="stop-bits">停止位</label>
                    <select id="stop-bits">
                        <option value="1"  selected>1</option>
                        <option value="2">2</option>
                    </select>
                </div>
                <div class="col">
                    <label>&nbsp;</label>
                    <button class="btn-ack" id="connect-btn">连接串口</button>
                </div>
            </div>
        </div>

        <!-- 协议选择部分 -->
        <div class="section protocol-section">
            <div class="section-title">协议配置</div>
            <div class="row">
                <div class="col">
                    <label for="protocol-select">协议类型</label>
                    <select id="protocol-select">
                        <option value="DL/T645">DL/T645-2007</option>
                        <option value="DL/T645-1997">DL/T645-1997</option>
                        <option value="DL/T698">DL/T698.45</option>
                        <option value="DL/T376.1">DL/T376.1</option>
                        <option value="DL/T376.2">DL/T376.2</option>
                        <option value="custom">自定义</option>
                    </select>
                </div>
                <div class="col">
                    <label for="frame-type">帧类型</label>
                    <select id="frame-type">
                        <option value="read">读数据</option>
                        <option value="write">写数据</option>
                        <option value="broadcast">广播</option>
                        <option value="response">响应</option>
                    </select>
                </div>
                <div class="col">
                    <label for="address">设备地址</label>
                    <input type="text" id="address" placeholder="12位表号或地址">
                </div>
            </div>
            <div class="row">
                <div class="col">
                    <label for="data-identifier">数据标识</label>
                    <input type="text" id="data-identifier" placeholder="如9010F000">
                </div>
                <div class="col">
                    <label for="data-value">数据值</label>
                    <input type="text" id="data-value" placeholder="写入的数据值">
                </div>
                <div class="col">
                    <label>&nbsp;</label>
                    <button class="btn-ack" id="build-frame-btn" class="btn-success">组包</button>
                </div>
            </div>
        </div>

        <!-- 数据收发部分 -->
        <div class="section data-section">
            <div class="section-title">数据收发</div>
            <div class="tab-container">
                <div class="tab-buttons">
                    <button class="tab-button active" data-tab="send">发送数据</button>
                    <button class="tab-button" data-tab="receive">接收数据</button>
                    <button class="tab-button" data-tab="history">历史记录</button>
                </div>
                <div id="send" class="tab-content active">
                    <label for="send-data">发送数据 (HEX格式)</label>
                    <textarea id="send-data" class="hex-textarea"
                        placeholder="输入16进制数据，如68 11 11 11 11 11 11 68 11 04 33 33 33 33 16"></textarea>
                    <div class="row">
                        <div class="col">
                            <button id="send-btn" class="btn-success">发送</button>
                        </div>
                        <div class="col">
                            <button id="clear-send-btn">清空</button>
                        </div>
                        <div class="col">
                            <button id="save-template-btn">保存为模板</button>
                        </div>
                    </div>
                </div>
                <div id="receive" class="tab-content">
                    <label for="receive-data">接收数据 (HEX格式)</label>
                    <textarea id="receive-data" class="hex-textarea" readonly></textarea>
                    <div class="row">
                        <div class="col">
                            <button id="parse-btn">解析数据</button>
                        </div>
                        <div class="col">
                            <button id="clear-receive-btn">清空</button>
                        </div>
                        <div class="col">
                            <button id="save-receive-btn">保存记录</button>
                        </div>
                    </div>
                </div>
                <div id="history" class="tab-content">
                    <div id="history-list">
                        <!-- 历史记录将通过JavaScript动态填充 -->
                        <div class="data-item">
                            <div class="data-item-header">2023-05-15 14:30:25 - DL/T645读数据</div>
                            <div>发送: 68 11 11 11 11 11 11 68 11 04 33 33 33 33 16</div>
                            <div>接收: 68 11 11 11 11 11 11 68 91 08 33 33 33 33 33 33 33 33 16</div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col">
                            <button id="clear-history-btn">清空历史</button>
                        </div>
                        <div class="col">
                            <button id="export-history-btn">导出历史</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- 数据解析结果 -->
        <div class="section">
            <div class="section-title">数据解析结果</div>
            <div id="parse-result">
                <div class="data-item">
                    <div class="data-item-header">帧头</div>
                    <div>68 - 起始符</div>
                </div>
                <div class="data-item">
                    <div class="data-item-header">地址域</div>
                    <div>11 11 11 11 11 11 - 表号: 111111111111</div>
                </div>
                <div class="data-item">
                    <div class="data-item-header">控制码</div>
                    <div>91 - 读数据应答</div>
                </div>
                <div class="data-item">
                    <div class="data-item-header">数据域长度</div>
                    <div>08 - 8字节</div>
                </div>
                <div class="data-item">
                    <div class="data-item-header">数据域</div>
                    <div>33 33 33 33 33 33 33 33 - 数据标识: 9010F000, 值: 1234.56 kWh</div>
                </div>
                <div class="data-item">
                    <div class="data-item-header">校验和</div>
                    <div>XX - 校验正确</div>
                </div>
                <div class="data-item">
                    <div class="data-item-header">帧尾</div>
                    <div>16 - 结束符</div>
                </div>
            </div>
        </div>

        <!-- 状态栏 -->
        <div class="status-bar" id="status-bar">
            就绪
        </div>
    </div>

    <script type="module" src="script.js"></script>
</body>

</html>